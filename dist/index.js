!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).GenError=e()}(this,function(){"use strict";function r(e,t){var n,r=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)),r}function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,l(r.key),r)}}function i(t,e,n){e&&o(t.prototype,e),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1})}function u(t,e,n){(e=l(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function f(t,e){var n,r,o,i,u="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(u)return r=!(n=!0),{s:function(){u=u.call(t)},n:function(){var t=u.next();return n=t.done,t},e:function(t){r=!0,o=t},f:function(){try{n||null==u.return||u.return()}finally{if(r)throw o}}};if(Array.isArray(t)||(u=function(t,e){var n;if(t)return"string"==typeof t?a(t,e):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}(t))||e&&t&&"number"==typeof t.length)return u&&(t=u),i=0,{s:e=function(){},n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:e};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(t){t=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);if("object"!=typeof(n=n.call(t,e||"default")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==typeof t?t:String(t)}var s="object"===("undefined"==typeof window?"undefined":e(window))?window:null,c=["Error","XHR","Fetch","Promise","Vue"];function p(t,e,n,r){t.addEventListener(e,n,3<arguments.length&&void 0!==r&&r)}function y(t,e,n,r){var r=3<arguments.length&&void 0!==r&&r;void 0!==t&&(e in t||r)&&"function"==typeof(r=n(t[e]))&&(t[e]=r)}function h(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function d(t,e,n){return t&&t[e]&&(h(t[e])===n||void console.error("".concat(e,"应该传入").concat(n,"类型")))}var t=function(){function t(){n(this,t),u(this,"handleErrors",{})}return i(t,[{key:"addSub",value:function(t){this.handleErrors[t.type]?this.handleErrors[t.type].push(t.cb):this.handleErrors[t.type]=[t.cb]}},{key:"notifiy",value:function(e,n){this.handleErrors[e].forEach(function(t){t(e,n)})}}]),t}(),b=new(function(){function t(){n(this,t),this.url="",this.filterUrl=[],this.transport=null}return i(t,[{key:"bindData",value:function(t){var e=t.url,n=t.filterUrl,r=t.transport;d(t,"url","string")&&(this.url=e),d(t,"filterUrl","array")&&(this.filterUrl=n),d(t,"transport","function")&&(this.transport=r)}},{key:"isOpUrl",value:function(t){return this.url===t}},{key:"isFilterUrl",value:function(t){return-1<this.filterUrl.indexOf(t)}}]),t}());function m(t,e){var n={type:t};switch(t){case"Error":n.filename=e.filename,n.message=e.message,n.souceType=e.type;break;case"XHR":case"Fetch":n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach(function(t){u(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({type:t},e);break;case"Promise":n.reason=e.reason,n.message=e.message,n.souceType=e.type;break;case"Vue":n.message=e.message,n.stack=e.stack}v(b.url,n)}function v(t,e){"function"===h(b.transport)?b.transport(e):fetch(t,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}})}var g=new t;function w(){var t,e,n=f(c);try{for(n.s();!(t=n.n()).done;){var r={type:t.value,cb:m};g.addSub(r)}}catch(t){n.e(t)}finally{n.f()}p(s,"error",function(t){g.notifiy("Error",t)}),p(s,"unhandledrejection",function(t){g.notifiy("Promise",t),console.log(11)}),"XMLHttpRequest"in s&&(y(e=XMLHttpRequest.prototype,"open",function(r){return function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.info_xhr={method:e[0],url:e[1],sTime:Date.now(),type:"XHR"},r.apply(this,e)}}),y(e,"send",function(o){return function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=this.info_xhr.url;p(this,"loadend",function(){b.isOpUrl(r)||b.isFilterUrl(r)||"function"===h(b.transport)||(this.info_xhr.reqData=e[0],this.info_xhr.status=this.status,this.info_xhr.elapsedTime=Date.now()-this.info_xhr.sTime,g.notifiy(this.info_xhr.type,this.info_xhr))}),o.apply(this,e)}})),"fetch"in s&&y(s,"fetch",function(o){return function(e,t){var n=Date.now(),r={type:"Fetch",method:t&&t.method||"GET",reqData:t&&t.body,url:e,sTime:n};return o.apply(this,[e,t]).then(function(t){return t.clone().text().then(function(){b.isOpUrl(e)||b.isFilterUrl(e)||"function"===h(b.transport)||(r.elapsedTime=Date.now()-n,r.status=t.status,g.notifiy(r.type,r))}),t},function(t){if(!b.isOpUrl(e)&&!b.isFilterUrl(e)&&"function"!==h(b.transport))throw r.elapsedTime=Date.now()-n,r.status=0,g.notifiy(r.type,r),t})}})}function O(t){(t=t)?t.url||"function"===h(t.transport)?b.bindData(t):console.error("general-error：参数url不能为空"):console.error("general-error：请传入参数"),w()}return{init:O,install:function(t){O(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{});var r=t.config.errorHandler;t.config.errorHandler=function(t,e,n){g.notifiy("Vue",t),r&&r.apply(null,[t,e,n])}},handleLog:function(t){t&&v(b.url,t)}}});
